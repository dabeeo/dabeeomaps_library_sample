<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="../dabeeo_ci_symbol.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation</title>
    <style>
        body {
            margin: 0;
        }

        .map {
            width: 1000px;
            height: 500px;
        }
    </style>
</head>

<body>
    <button type="button" class="button-menu" name="set">draw route</button>
    <button type="button" class="button-menu" name="clear">clear route</button>
    <button type="button" class="button-menu" name="start">start animation</button>
    <button type="button" class="button-menu" name="stop">stop animation</button>
    <div name="naviList" style="display:none;"></div>
    <div id='map' class="map"></div>
</body>
<script type="text/javascript" src='https://assets.dabeeomaps.com/upload/library/dabeeomaps-4.1.0.js'></script>
<script>

    async function init () {
        const dabeeoMaps = new dabeeo.Maps();

        //fetch a map
        const mapData = await dabeeoMaps.getMapData({
            clientId: "75hb8YSnAokb-sZ04aDR91",
            clientSecret: "0f7ad84f160c7b3fd1849a7920af718b"
        });

        //get route information 
        const naviResponse = getRoute(mapData);
        console.log(naviResponse);

        // render a map
        const mapOption = Object.assign({
            // camera: "2d"

        });
        const mapContainer = document.getElementById('map');
        const map = await dabeeoMaps.showMap(mapContainer, mapOption, mapData);

        //disable camera rotation with mouse
        map.control.setOption({
            mouseOption: {
                enableZoom: true,
                enableRotate: false,
                enablePan: true,
                enableTilt: false,
                buttonOption: {
                    left: 'PAN',
                    middle: 'ZOOM',
                    right: 'ROTATE'
                }
            },
            touchOption: {
                enableZoom: true,
                enableRotate: false,
                enablePan: true,
                enableTilt: false,
            }
        });

        //initialize events
        initRouteEvent(map, naviResponse);
    }

    function getRoute (data) {
        const routeOption = {
            origin: {
                poiId: "PO-WgCv1-qBo8094", // 사업전략부 (11 floor)
                floorId: "FL-t4vqgyek3jnb8146",
            },
            // destination: {
            //     poiId: "PO-NMvw3E0pe1690", // 플랫폼사업부 회의실 (11 floor )
            //     floorId: "FL-t4vqgyek3jnb8146"
            // },
            destination: {
                poiId: "PO-9InVzIGv20417", // 남자화장실 (2 floor )
                floorId: "FL-vf3q07spbmsw8132",
            }
        }
        return (data.getRoute(routeOption));
    }


    function initRouteEvent (map, naviResponse) {

        document.querySelector("[name='set']").addEventListener('click', function () {
            setRoute(map, naviResponse);
            showRouteInfo(map, naviResponse);
        });

        document.querySelector("[name='clear']").addEventListener('click', function () {
            map.routeSimulation.clear();
            const element = document.querySelector("[name='naviList']");
            element.style.display = "none";
            element.innerHTML = "";


        })

        document.querySelector("[name='start']").addEventListener('click', function () {
            map.routeSimulation.start();
        });

        document.querySelector("[name='stop']").addEventListener('click', function () {
            map.routeSimulation.stop();
        })
    }
    function showRouteInfo (map, naviResponse) {
        const element = document.querySelector("[name='naviList']");
        element.style.display = "block";

        // navigation list 버튼 추가
        naviResponse.navigationList.forEach((item) => {
            const move = () => {
                item.move(map); // 해당 navigation 경로로 이동하는 함수 호출
            }
            const button = document.createElement('button');
            button.onclick = move;
            button.textContent = item.title;
            console.log(item.title);
            // button.style.cssText = 'width: 100%; height: 2rem;';

            element.appendChild(button);
        });
    }

    function setRoute (map, naviResponse) {
        const naviOption = {
            defaultLineOption: {
                lineColor: "#0000ff",
                solidLineEnabled: true,
                solidLineWidth: 10,
            }, // 기본 주행선 옵션
        }
        map.routeSimulation.set(naviResponse, naviOption);
    }



    init();


</script>

</html>