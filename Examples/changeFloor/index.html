<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="../dabeeo_ci_symbol.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>change floor sample</title>
    <style>
        .map {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>

<body>
    <button type="button" class="button-menu">floor</button>
    <select type="text" class="inline-input" name="floor"></select>
    <div id='map' class="map"></div>
</body>
<script type="text/javascript" src='https://assets.dabeeomaps.com/upload/library/dabeeomaps-4.1.0.js'></script>
<script>
    async function init () {
        const dabeeoMaps = new dabeeo.Maps();

        ////fetch a map
        const mapData = await dabeeoMaps.getMapData({
            clientId: "75hb8YSnAokb-sZ04aDR91",
            clientSecret: "0f7ad84f160c7b3fd1849a7920af718b"
        });

        ////menu initialization 
        //floor data 
        const dataFloor = mapData.dataFloor;

        // default value is defined in DabeeoMap Editor 
        initFloorMenu(dataFloor.getFloors(), dataFloor.getDefaultFloor());

        //// render a map
        const mapOption = Object.assign({
            // floor: "FL-vf3q07spbmsw8132" // you can change floor when rendering a map 
        });
        const mapContainer = document.getElementById('map');
        const map = await dabeeoMaps.showMap(mapContainer, mapOption, mapData);

        ////menu initialization
        //read floor option and set floor value
        initFloorEvent(map, map.context.getMapOptions().floor);
    }

    function initFloorMenu (floorInfo, mapDefaultFloor) {
        let element = document.querySelector("[name='floor']");

        for (const floor of floorInfo) {
            let newOption = document.createElement("option");
            newOption.value = floor.id;
            newOption.appendChild(document.createTextNode(floor.name[0].text));
            element.appendChild(newOption);
        }
        element.value = mapDefaultFloor.id;

    }

    function initFloorEvent (map, optionDefaultFloor) {
        let element = document.querySelector("[name='floor']");
        element.value = optionDefaultFloor;
        element.addEventListener("change", function (e) {
            const floor = e.target.value
            map.context.changeFloor(floor);
        });
    }

    init();
</script>

</html>